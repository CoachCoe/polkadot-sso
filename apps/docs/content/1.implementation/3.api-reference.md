---
title: API Reference
description: Complete API documentation for Polkadot SSO Better Auth plugin
---

# API Reference

Complete reference for the Polkadot SSO Better Auth plugin API.

## Plugin Configuration

### PolkadotPluginOptions

```typescript
interface PolkadotPluginOptions {
  providers: PolkadotProvider[]
  chains?: {
    polkadot?: string
    kusama?: string
    westend?: string
  }
  rpcUrls?: {
    polkadot?: string
    kusama?: string
    westend?: string
  }
}
```

### PolkadotProvider

```typescript
interface PolkadotProvider {
  id: string
  name: string
  chain: string
  rpcUrl: string
  ss58Format: number
  decimals: number
  tokenSymbol: string
}
```

## Server API Endpoints

### POST /api/auth/polkadot/challenge

Generate a cryptographic challenge for wallet authentication.

**Request:**
```typescript
{
  address: string
  chain: string
}
```

**Response:**
```typescript
{
  message: string
  nonce: string
  chain: string
  expiresAt: number
}
```

**Example:**
```bash
curl -X POST http://localhost:3001/api/auth/polkadot/challenge \
  -H "Content-Type: application/json" \
  -d '{
    "address": "1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V3W4X5Y6Z",
    "chain": "polkadot"
  }'
```

### POST /api/auth/polkadot/verify

Verify a signature and create a user session.

**Request:**
```typescript
{
  signature: string
  address: string
  message: string
  chain: string
}
```

**Response:**
```typescript
{
  user: PolkadotUser
  session: PolkadotSession
  token: string
}
```

**Example:**
```bash
curl -X POST http://localhost:3001/api/auth/polkadot/verify \
  -H "Content-Type: application/json" \
  -d '{
    "signature": "0x1234567890abcdef...",
    "address": "1A2B3C4D5E6F7G8H9I0J1K2L3M4N5O6P7Q8R9S0T1U2V3W4X5Y6Z",
    "message": "Sign this message to authenticate...",
    "chain": "polkadot"
  }'
```

### GET /api/auth/session

Get the current user session.

**Headers:**
```
Authorization: Bearer <jwt-token>
```

**Response:**
```typescript
{
  user: PolkadotUser
  session: PolkadotSession
}
```

### POST /api/auth/signout

Sign out the current user and invalidate the session.

**Headers:**
```
Authorization: Bearer <jwt-token>
```

**Response:**
```typescript
{
  message: "Signed out successfully"
}
```

## Client API

### usePolkadotAuth Hook

React hook for managing Polkadot authentication state.

```typescript
interface UsePolkadotAuthOptions {
  appName: string
  ssoUrl: string
}

interface UsePolkadotAuthReturn {
  accounts: PolkadotAccount[]
  user: PolkadotUser | null
  session: PolkadotSession | null
  loading: boolean
  error: string | null
  connectWallet: () => Promise<void>
  signIn: (address: string, chain: string) => Promise<void>
  signOut: () => Promise<void>
  refreshSession: () => Promise<void>
}
```

**Usage:**
```typescript
import { usePolkadotAuth } from "@polkadot-sso/better-auth-polkadot"

function LoginComponent() {
  const { 
    accounts, 
    user, 
    loading, 
    error, 
    connectWallet, 
    signIn, 
    signOut 
  } = usePolkadotAuth({
    appName: "My App",
    ssoUrl: "http://localhost:3001"
  })

  // Component logic...
}
```

### PolkadotAuthClient

Direct client for programmatic authentication.

```typescript
class PolkadotAuthClient {
  constructor(appName: string, ssoUrl: string)
  
  async getAccounts(): Promise<PolkadotAccount[]>
  async signMessage(address: string, message: string): Promise<string>
  async authenticate(address: string, chain: string): Promise<any>
}
```

**Usage:**
```typescript
import { createPolkadotAuthClient } from "@polkadot-sso/better-auth-polkadot"

const client = createPolkadotAuthClient("My App", "http://localhost:3001")
const accounts = await client.getAccounts()
const result = await client.authenticate(accounts[0].address, "polkadot")
```

### PolkadotWalletSelector Component

Pre-built React component for wallet selection and authentication.

```typescript
interface PolkadotWalletSelectorProps {
  appName: string
  ssoUrl: string
  onSuccess?: (user: any) => void
  onError?: (error: string) => void
}
```

**Usage:**
```typescript
import { PolkadotWalletSelector } from "@polkadot-sso/better-auth-polkadot"

function App() {
  return (
    <PolkadotWalletSelector
      appName="My App"
      ssoUrl="http://localhost:3001"
      onSuccess={(user) => console.log("Authenticated:", user)}
      onError={(error) => console.error("Auth error:", error)}
    />
  )
}
```

## Data Types

### PolkadotAccount

```typescript
interface PolkadotAccount {
  address: string
  name?: string
  source: string
  chain: string
}
```

### PolkadotUser

```typescript
interface PolkadotUser {
  id: string
  address: string
  chain: string
  provider: string
  createdAt: Date
  updatedAt: Date
}
```

### PolkadotSession

```typescript
interface PolkadotSession {
  id: string
  userId: string
  token: string
  expiresAt: Date
  createdAt: Date
}
```

### PolkadotChallenge

```typescript
interface PolkadotChallenge {
  message: string
  nonce: string
  chain: string
  expiresAt: number
}
```

### PolkadotSignature

```typescript
interface PolkadotSignature {
  signature: string
  address: string
  message: string
  chain: string
}
```

## Error Handling

### Error Types

```typescript
interface PolkadotAuthError {
  error: string
  code: string
  details?: any
}
```

### Common Error Codes

- `NO_WALLET`: No Polkadot wallet extensions found
- `INVALID_SIGNATURE`: Signature verification failed
- `CHALLENGE_EXPIRED`: Challenge has expired
- `UNSUPPORTED_CHAIN`: Chain is not supported
- `MISSING_PARAMETERS`: Required parameters are missing
- `AUTH_FAILED`: General authentication failure

### Error Handling Example

```typescript
try {
  const result = await client.authenticate(address, chain)
  // Handle success
} catch (error) {
  switch (error.code) {
    case 'NO_WALLET':
      // Show wallet installation instructions
      break
    case 'INVALID_SIGNATURE':
      // Show signature error message
      break
    case 'CHALLENGE_EXPIRED':
      // Retry authentication
      break
    default:
      // Show generic error message
      break
  }
}
```

## Utility Functions

### Crypto Utilities

```typescript
// Generate a challenge message
generateChallenge(address: string, chain: string): string

// Generate a random nonce
generateNonce(): string

// Validate an address format
isValidAddress(address: string, ss58Format: number): boolean

// Format an address for display
formatAddress(address: string, length?: number): string

// Verify a signature
verifySignature(message: string, signature: string, address: string, provider: PolkadotProvider): Promise<boolean>
```

**Usage:**
```typescript
import { 
  generateChallenge, 
  isValidAddress, 
  formatAddress 
} from "@polkadot-sso/better-auth-polkadot"

const challenge = generateChallenge(address, "polkadot")
const isValid = isValidAddress(address, 0)
const displayAddress = formatAddress(address, 8)
```