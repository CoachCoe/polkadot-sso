---
title: API Reference
description: Complete API documentation for all SSO endpoints
---

# API Reference

## Base URL

```
http://localhost:3001/api/auth
```

Production URL will depend on your deployment configuration.

## Authentication Endpoints

### Create Challenge

Generate an authentication challenge for wallet signing.

```http
GET /api/auth/challenge
```

**Query Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `client_id` | string | Yes | Application client identifier |
| `address` | string | Yes | Polkadot address to authenticate |
| `chain` | string | No | Blockchain network (default: "westend") |

**Response:**

Returns an HTML page with embedded challenge data. Extract using JavaScript:

```javascript
// Extract from window.CHALLENGE_DATA
const challengeData = {
  challengeId: "clq2x9k8s0000qw3k8h3j9d7f",
  message: "Sign this message to authenticate...",
  codeVerifier: "dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk",
  state: "xyz789",
  address: "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY"
};
```

**Example:**

```javascript
const response = await fetch(
  'http://localhost:3001/api/auth/challenge?' +
  'client_id=demo-client&' +
  'address=5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY&' +
  'chain=westend'
);
```

---

### Check Challenge Status

Check if a challenge is still valid or has been used.

```http
GET /api/auth/status/:challengeId
```

**Path Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `challengeId` | string | Yes | Challenge identifier |

**Response:**

```json
{
  "status": "pending",  // or "used", "expired"
  "message": "Challenge is pending verification",
  "expiresAt": 1704120000000,
  "challengeId": "clq2x9k8s0000qw3k8h3j9d7f"
}
```

**Status Codes:**

- `200 OK` - Challenge status retrieved
- `404 Not Found` - Challenge not found

---

### Verify Signature

Verify the signed challenge and get authorization code.

```http
GET /api/auth/verify
```

**Query Parameters:**

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| `signature` | string | Yes | Wallet signature (hex format) |
| `challenge_id` | string | Yes | Challenge identifier |
| `address` | string | Yes | Signer's Polkadot address |
| `code_verifier` | string | Yes | PKCE code verifier |
| `state` | string | Yes | State parameter for CSRF protection |

**Response:**

Redirects to callback URL with authorization code:

```
HTTP/1.1 302 Found
Location: http://localhost:5173/callback?code=auth_xyz123&state=xyz789
```

**Error Response:**

Redirects with error:

```
Location: http://localhost:5173/callback?error=invalid_signature&state=xyz789
```

**Example:**

```javascript
const params = new URLSearchParams({
  signature: '0x1234...',
  challenge_id: 'clq2x9k8s0000qw3k8h3j9d7f',
  address: '5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY',
  code_verifier: 'dBjftJeZ4CVP-mB92K27uhbUJU1p1r_wW1gFWFOEjXk',
  state: 'xyz789'
});

window.location.href = `http://localhost:3001/api/auth/verify?${params}`;
```

---

### Exchange Code for Tokens

Exchange authorization code for JWT access and refresh tokens.

```http
POST /api/auth/token
```

**Headers:**

```
Content-Type: application/json
```

**Request Body:**

```json
{
  "grant_type": "authorization_code",
  "code": "auth_xyz123",
  "client_id": "demo-client",
  "client_secret": "default-client-secret-for-development-only",
  "redirect_uri": "http://localhost:5173/callback"
}
```

**Response:**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "Bearer",
  "expires_in": 900,
  "scope": "read"
}
```

**Status Codes:**

- `200 OK` - Tokens generated successfully
- `400 Bad Request` - Invalid request parameters
- `401 Unauthorized` - Invalid client credentials
- `403 Forbidden` - Code expired or already used

---

### Refresh Access Token

Get new access token using refresh token.

```http
POST /api/auth/token
```

**Request Body:**

```json
{
  "grant_type": "refresh_token",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "client_id": "demo-client",
  "client_secret": "default-client-secret-for-development-only"
}
```

**Response:**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs...",
  "refresh_token": "eyJhbGciOiJIUzI1NiIs...",
  "token_type": "Bearer",
  "expires_in": 900,
  "scope": "read"
}
```

---

### Get Session Information

Retrieve current authenticated session details.

```http
GET /api/auth/session
```

**Headers:**

```
Authorization: Bearer {access_token}
```

**Response:**

```json
{
  "user": {
    "address": "5GrwvaEF5zXb26Fz9rcQpDWS57CtERHpNehXCPcNoHGKutQY",
    "chain": "westend",
    "wallet": "polkadot-js"
  },
  "accessToken": "eyJhbGciOiJIUzI1NiIs...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIs...",
  "expiresAt": "2024-01-01T12:15:00.000Z"
}
```

**Status Codes:**

- `200 OK` - Session retrieved
- `401 Unauthorized` - Invalid or expired token

---

### Logout

Invalidate the current session and tokens.

```http
POST /api/auth/logout
```

**Headers:**

```
Authorization: Bearer {access_token}
```

**Request Body:**

```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIs..."
}
```

**Response:**

```json
{
  "message": "Logged out successfully"
}
```

**Status Codes:**

- `200 OK` - Logout successful
- `400 Bad Request` - Missing access token
- `500 Internal Server Error` - Logout failed

---

## Administrative Endpoints

### Health Check

Check if the SSO service is running.

```http
GET /health
```

**Response:**

```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T12:00:00.000Z",
  "environment": "development",
  "version": "1.0.0"
}
```

---

### API Documentation

View interactive API documentation.

```http
GET /api/auth/docs
```

Returns an HTML page with API documentation.

---

## Rate Limits

All endpoints are rate-limited to prevent abuse:

| Endpoint | Limit | Window |
|----------|-------|--------|
| `/challenge` | 10 requests | 1 minute |
| `/verify` | 5 requests | 1 minute |
| `/token` | 5 requests | 1 minute |
| `/session` | 30 requests | 1 minute |
| `/logout` | 10 requests | 1 minute |

Rate limit headers are included in responses:

```
X-RateLimit-Limit: 10
X-RateLimit-Remaining: 7
X-RateLimit-Reset: 1704120000
```

## Error Responses

All errors follow a consistent format:

```json
{
  "error": "invalid_request",
  "error_description": "The request is missing a required parameter",
  "details": {
    "field": "client_id",
    "message": "Client ID is required"
  }
}
```

### Common Error Codes

| Code | Description |
|------|-------------|
| `invalid_request` | Missing or invalid parameters |
| `invalid_client` | Client authentication failed |
| `invalid_grant` | Authorization code or refresh token is invalid |
| `unauthorized_client` | Client not authorized for this grant type |
| `unsupported_grant_type` | Grant type not supported |
| `invalid_signature` | Signature verification failed |
| `challenge_expired` | Challenge has expired |
| `challenge_used` | Challenge already used |
| `rate_limit_exceeded` | Too many requests |

## Security Headers

All responses include security headers:

```
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Strict-Transport-Security: max-age=31536000; includeSubDomains
Content-Security-Policy: default-src 'self'
```

## CORS Configuration

CORS is configured for allowed origins:

```javascript
// Allowed origins from environment
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

// CORS headers
Access-Control-Allow-Origin: http://localhost:5173
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization
Access-Control-Allow-Credentials: true
```

## WebSocket Support (Coming Soon)

Real-time authentication status updates:

```javascript
const ws = new WebSocket('ws://localhost:3001/api/auth/ws');

ws.on('message', (data) => {
  const event = JSON.parse(data);
  // { type: 'challenge_signed', challengeId: '...', status: 'success' }
});
```